## 5.5 소프트웨어 정의 네트워크(SDN) 제어 평면

- SDN 구조의 4가지 특징 
(1) 플로우 기반 포워딩
(2) 데이터 평면과 제어 평면의 분리 
(3) 네트워크 제어 기능이 데이터 평면 스위치 외부에 존재 
(4) 프로그램이 가능한 네트워크 

    - (1) 플로우 기반 포워딩
    : 전통적인 라우터 기반 포워딩은 데이터그램의 목적지 주소를 기반으로 이루어지는 반면,
    플로우 기반 포워딩은 트랜스포트 계층, 네트워크 계층, 또는 링크 계층 헤더의 어떤 값을 기반으로 하든 이루어질 수 있음 
    : SDN에서는 모든 네트워크 스위치의 플로우 테이블 항목들을 계산하고 관리, 설치하는 일들이 모두 SDN제어 평면의 임무
    - (2) 데이터 평면과 제어 평면의 분리
    : 데이터 평면 => '매치 플러스 액션' 수행, 네트워크의 스위치들로 구성
    : 제어 평면 => 서버와 스위치들의 플로우 테이블을 결정, 관리하는 소프트웨어로 이루어짐
    - (3) 네트워크 제어 기능이 데이터 평면 스위치 외부에 존재 
        - *제어평면의 구성요소 (크게) 2개*
            - SDN 컨트롤러, 네트워크 제어 애플리케이션의 집합 
            - 컨트롤러 => 네트워크 제어 애플리케이션 : 정확한 상태 정보 제공
            - 애플리케이션 => 컨트롤러 : 명령 (ex. 이런 정책으로 트래픽 관리해줘.. )(kind of 뇌의 뇌)
            - 네트워크 제어 애플리케이션의 종류 : 라우팅 app, 방화벽, 로드 밸런서, QoS, 보안 모니터링 등
        - *제어평면의 구성요소 (작게) 4개*
            - 네트워크 제어 애플리케이션의 집합 ==gogo==> 노스바운드 API ==gogo==> SDN 컨트롤러 ==gogo==> 사우스바운드 API ==gogo==> SDN으로 제어되는 장치들
            - 노스바운드 API 
            : 네트워크 제어 애플리케이션이 SDN컨트롤러로 보내는 정책 전달 >>통로<<
            : 메시지 가공하여 컨트롤러에 전달 
            - 사우스바운드 API
            : 실행 명령 통로
            : OpenFlow 명령어로 가공해서 스위치한테 전달 
    - (4) 프로그램이 가능한 네트워크
    : 네트워크를 프로그램할 수 있음 (네트워크 동작을 코드로 정의 가능)
        => 자동화, 조건별 처리, 시간대별 정책도 사용 가능 
        => 과거 네트워크는 설정만 가능 (CLI로)
            => 메뉴판에서 고르는 느낌.. 

SDN을 통해 개방된, 유연한 생태계가 만들어졌다. 모든 것을 하나에서 해결하지 않고,
각 분야 다른 회사가 따로 만든 걸 조합해서 쓸 수 있게 해준 것이 SDN의 장점이다. 

((** 개념공부 : 플로우 테이블(in SDN) vs 포워딩 테이블))
- 플로우 테이블 
    - 구성 : match 필드, 액션, 우선순위, 통계정보 등
    - 역할 : 각 패킷에 어떤 처리를 해야 할지 결정하는 룰의 집합
    - 상황 전체를 보는 느낌
- 포워딩 테이블 
    - 구성 : 목적지 주소 -> 출력 포트 
    - 역할 : 목적지 IP 기반으로 포트만 결정 
    - 주소만 보는 느낌 (빠르지만, 유연하진 않을수도..)

### 5.5.1 SDN 제어 평면; SDN 컨트롤러와 SDN 네트워크 제어 애플리케이션

- SDN 컨트롤러의 기능 : 3가지 계층
    : 통신 계층, 네트워크 전역 상태 관리 계층, 네트워크 제어 애플리케이션 계층과의 인터페이스

    - (1) 통신 계층
    : SDN 컨트롤러와 제어받는 네트워크 장치들 사이의 통신 
        - 네트워크 장치와의 연결 유지, 상태를 보고 받음 
        - OpenFlow 같은 프로토콜로 통신 
    - (2) 네트워크 전역 상태 관리 계층 
        - 네트워크 호스트와 링크 스위치 그리고 다른 장치들에 대한 최신 정보를 알아야 함 
        - 플로우 테이블의 카운터 정보도 수집
          (*카운터 : 룰이 얼마나 쓰였는지, 얼마나 자주 작동하는지 알려주는 정보.)
          (ex. 이 룰이 처리한 패킷 개수 )
    - (3) 네트워크 제어 애플리케이션 계층과의 인터페이스 
        - 애플리케이션이 컨트롤러에 정책을 요청할 수 있게 하는 API 제공 
            (대표적 : REST API)

### 5.5.2 OpenFlow 프로토콜 

- TCP상 디폴트 포트 번호 6653을 가지고 동작
- 명령 전달 & 상태 수신 

- 컨트롤러가 제어되는 스위치로 전달하는 중요한 메시지 
    - 설정, 상태 수정, 상태 읽기, 패킷 전송 
        
    - 설정
        : 스위치의 포트 상태, 동작 방식 등을 설정 
    - 상태 수정 (핵심) 
        : 스위치의 플로우 테이블에 룰 추가, 수정, 제거
    - 패킷 전송
        : 특정 패킷을 특정 포트로 보내라고 명령 
    - 상태 읽기 
        : 스위치가 가진 통계 정보 요청

- 컨트롤러로 전달되는 주요 메시지
    - 플로우 제거, 포트 상태, 패킷 전달 

    - 플로우 제거
        : 룰이 시간초과 되었거나 삭제되었을 때 보고 
    - 포트 상태
        : 포트가 새로 연결되거나 끊어졌거나 장애가 생기면 보고 받음
    - 패킷 전달 
        : 스위치가 받은 패킷을 처리하는 룰이 없을 때 컨트롤러에 패킷 전달
        (어떻게 할 지 모르겠다.. 어떻게 할 지 알려주쇼)

### 5.5.3 데이터 평면과 제어 평면의 상호작용 : 예제 

### 5.5.4 SDN: 과거와 미래 

## 5.6 인터넷 제어 메시지 프로토콜 (ICMP)
: 호스트와 라우터가 서로 간에 네트워크 계층 정보를 주고받기 위해 사용
    (데이터 전달 X, 네트워크 문제 상황 전달)
: 전형적인 사용 형태는 "오류보고"
: IP 패킷의 전달을 보조하는 '신호' 전용 프로토콜 

- ICMP 메시지가 IP 데이터그램 (중에서도 IP 페이로드)에 담겨 전송되지만, 
  IP위에 올라간 독립된 프로토콜
- ICMP도 역다중화함 
    - TCP, UDP 는 포트 번호로 구분했는데, 
    ICMP는 타입/코드 필드로 내부 처리를 나눔 

- ICMP 메시지 중에 출발지 억제 메시지가 있는데, 잘 쓰이지는 않음
    - 비신뢰성, 보안 문제, 계층위반(그건 tcp가 알아서 할 일..) 문제 때문

- Traceroute (사실,, ICMP메시지를 활용한다)
    : 출발지와 목적지 사이의 라우터의 이름과 주소를 알아내기 위한 프로그램

    - 어떻게 알아내냐? 
        - TTL을 1로 설정(가서 바로 죽게.. ) (물론 더 멀어지면 TTL 값이 2, 3, 4 이렇게 변함)
        - 중간 목적지의 IP 주소는 몰라도 최종 목적지로의 여정을 떠난 데이터그램이 TTL 때문에 죽고,
        죽으면 거기서 ICMP 메시지를 보냄. 이 메시지에 중간 라우터의 IP 주소가 들어 있음 
    
## 5.7 네트워크 관리와 SNMP, NETCONF/YANG

### 5.7.1 네트워크 관리 프레임워크
네트워크 관리의 핵심 요소 
- 관리 서버 (managing server)
- 피관리 장치
- 데이터 네트워크 관리 에이전트
- 네트워크 관리 프로토콜 

    - 관리 서버 
        - 네트워크 장비를 통제하는 중앙 서버
        - 정보 수집, 분석 등 전반적인 네트워크 관리 기능 
        - 하나의 네트워크는 여러 개의 관리 서버를 가질 수 있음
    - 피관리 장치
        - 관리 대상 네트워크에 존재하는 네트워크 장비(소프트웨어 포함)등
        - 호스트, 라우터, 스위치, 미들박스, 모뎀, 온도계, 그리고 네트워크에 연결된 그 밖의 장치
    - 데이터
        - 설정 데이터 : 장치 정보
        - 동작 데이터 : 장치가 동작하면서 획득하는 정보
        - 장치 통계 
    - 네트워크 관리 에이전트
        - 관리 서버와 통신하는 피관리 장치상의 소프트웨어 프로세스 
    - 네트워크 관리 프로토콜
        - 관리 서버와 피관리 장치들 사이에서 동작

네트워크 관리하는 세가지 방법
- CLI (명령줄 인터페이스)
- SNMP/MIB
- NETCONF/YANG

    - CLI (명령줄 인터페이스)
    - SNMP/MIB
        - SNMP : 네트워크 장비의 정보를 조회하거나 설정하는 프로토콜
        - MIB : 장치가 갖고 있는 관리용 데이터 저장소
        - 운영자는 이 방식으로 상태/통계를 모니터링, 명령은 CLI로 
    - NETCONF / YANG
        - 네트워크를 하나의 시스템처럼 바라봄
        - 장비 전체를 하나의 스크립트로 통제 가능
        => 네트워크 설계 그 자체,
        - YANG : 데이터 모델링 언어
        - NETCONF : YANG 기반 설정을 주고받는 프로토콜 

### 5.7.2 SNMP와 MIB
- SNMP (Simple Network Management Protocol)
    - 네트워크 장비를 모니터링하고 관리하기 위한 표준 프로토콜
    - 요청 - 응답 모드 (가장 흔함)
    - 트랩 메시지를 관리 서버에게 전송(에이전트가 요구받지 않았더라도)
        : 관리 서버들에게 MIB 객체 값을 변화시킨 예외상황의 발생을 통지하기 위해 이용
    
    - PDU(protocol data unit) 7가지 
        - GetRequest        : 하나 또는 그 이상의 MIB 객체 인스턴스 값을 가져온다.
        - GetNextRequest    : 목록 또는 테이블에서 다음 MIB 객체 인스턴스의 값을 가져온다.
        - GetBulkRequest    : 큰 블록 단위의 데이터를 가져온다. 예를 들면, 큰 테이블의 값들이다.
        - InformRequest     : 원격으로 접근하는 원격 관리 서버에게 MIB 값을 알린다.
        - SetRequest        : 하나 또는 그 이상의 MIB 객체 인스턴스들의 값들을 설정한다.
        - Response          : GetRequest, GetNextRequest, GetBulkRequest, SetRequest PDU 또는
                                InformRequest에 대한 응답으로 발생한다. 
        - SNMPv2-Trap       : 관리자에게 예외적인 이벤트 발생을 알린다.

### 5.7.3 네트워크 설정 프로토콜(NETCONF)과 YANG 

- NETCONF 프로토콜 
    : 피관리 장치에게 명령을 코드처럼 전달하는 설정 전용 프로토콜 
        - 관리 서버와 피관리 네트워크 장치 사이에서 동작
        - 피관리 장치의 설정 데이터를 검색, 셋업, 수정
        - 피관리 장치의 동작 데이터 및 통계를 질의
        - 피관리 장치에서 생성된 알림을 구독하기 위한 메시지 전송 기능을 제공
    - XML문서 형식의 설정 내용을 보내 피관리 장치에서 활성화 
    - RPC 패러다임을 사용 

- NETCONF 주요 작업 
    - <get-config>
        - 어떤 설정의 전체 또는 일부를 검색
        - 하나의 장치가 여러 개의 설정을 가질 수 있음 
        - 언제나 running/ 설정이 있어서 장치의 현재 (실행 중인) 설정을 기술 
    - <get>
        - 설정 상태 및 동작 상태 데이터의 전체 또는 일부를 검색
    - <edit-config>
        - 피관리 장치 특정 설정의 전체 또는 일부를 변경
        - 만일 running/ 설정이 지정되면 장치의 현재 (실행 중인) 설정이 변경된
    - <lock>, <unlock>
        - 설정 데이터 저장소 시스템을 잠그거나 잠금해제할 수 있음 
        - 관리자가 다른 소스의 NETCONF, SNMP 또는 CLI명령과의 혼선에 대한 걱정 없이 변경할 수 있게 해줌
    - <create-subscription>, <notification>
        - 구독을 종료할 때까지 관심 있는 특정 이벤트에 대한 <notification>을 피관리 장치에서 관리 서버로 비동기 방식으로 보내도록 지사한다. 

- YANG
    : 데이터 모델링 언어
    (어떤 설정 데이터를 쓸 수 있는지, 어떤 형식인지를 설계하는 언어) like 설계도 