# 5 네트워크 계층 : 제어 평면

## 5.5 소프트웨어 정의 네트워크(SDN) 제어 평면

- SDN 구조의 특징
  - 플로우 기반 포워딩
    - SDN으로 제어되는 스위치들에서의 패킷 전달은 트랜스포트 계층, 네트워크 계층, 또는 링크 계층 헤더의 어떤 값을 기반으로 하든 이루어질 수 있다.
    - SDN에서는 모든 네트워크 스위치의 플로우 테이블 항목들을 계산하고 관리, 설치하는 일들이 모두 SDN 제어 평면의 임무다.
  - 데이터 평면과 제어 평면의 분리
    - 데이터 평면은 네트워크의 스위치들로 구성되는데, 이들은 상대적으로 단순한(그러나 빠른)장치들로서 자신들의 플로우 테이블 내용을 기반으로 '매치 플러스 액션'을 수행한다.
    - 제어 평면은 서버와 스위치들의 플로우 테이블을 결정, 관리하는 소프트웨어로 이루어진다.
  - 네트워크 제어 기능이 데이터 평면 스위치 외부에 존재
    - SDN 제어 평면이 소프트웨어로 구현되어 있다.
    - 이 소프트웨어는 네트워크 스위치로부터 멀리 떨어진 별도의 서버에서 수행된다.
    - 일반적으로 협업 능력과 확장성 그리고 높은 이용성을 갖도록 몇 개의 서버에 구현한다.
  - 프로그램이 가능한 네트워크
    - 제어 평면에서 수행 중인 네트워크 제어 애플리케이션을 통해 네트워크를 프로그램할 수 있다.
    - 이 애플리케이션들은 SDN 제어 평면의 '두뇌'로서 SDN 컨트롤러가 제공하는 API를 이용하여 네트워크 장치들에 있는 데이터 평면을 명세하고 제어한다.
- SDN 제어 평면의 역할
  - 플로우 테이블 계산
  - 플로우 테이블들은 SDN으로 제어되는 장치들에서 발생하는 사건에 대응하고 갱신
  - 여러 스위치들의 플로우 테이블 엔트리들이 네트워크 전역과 관련된 기능들의 일관성 유지 및 조율

### 5.5.1 SDN 제어 평면 : SDN 컨트롤러와 SDN 네트워크 제어 애플리케이션

- 컨트롤러의 기능은 크게 3개의 계층으로 구성된다.
  - 통신 계층 : SDN 컨트롤러와 제어받는 네트워크 장시들 사이의 통신
  - 네트워크 전역 상태 관리 계층
  - 네트워크 제어 애플리케이션 계층과의 인터페이스
- 컨트롤러는 외부(예를 들면, SDN으로 제어되는 장치들 및 외부 네트워크 제어 애플리케이션의 관점)에서 볼 때 잘 짜여진 하나의 서비스로 보일 수 있다.
- 실제로는 분산된 서버의 집합에 구현된다.

### 5.5.2 OpenFlow 프로토콜

- OpenFlow 프로토콜은 SDN 컨트롤러와 SDN으로 제어되는 스위치 또는 OpenFlow API를 구현하는 다른 장치와의 사이에서 동작한다.
- 컨트롤러가 제어되는 스위치로 전달하는 중요한 메시지들
  - 설정
  - 상태 수정
  - 상태 읽기
  - 패킷 전송
- SDN으로 제어되는 스위치에서 컨트롤러로 전달되는 주요 메시지들
  - 플로우 제거
  - 포트 상태
  - 패킷 전달

### 5.5.3 데이터 평면과 제어 평면의 상호작용 : 예제

### 5.5.4 SDN : 과거와 미래

- SDN 혁명은 '단순한 상용 스위칭 하드웨어와 정교한 소프트웨어 제어 평면'으로 '모든 기능이 하나로 통합된 스위치와 라우터(데이터 및 제어 평면 모두)'를 교체해나가고 있다.
- 네트워크 기능 가상화(Network Functions Virtualization, NFV)로 알려진 SDN의 일반화는 단순한 상용 서버, 스위칭 및 저장소를 가지고 복잡한 미들박스(전용 하드웨어 및 미디어 캐싱 / 서비스를 위한 고유의 소프트웨어를 가진 미들박스)를 혁신적으로 교체하는 것을 목표로 한다.
- SDN 개념을 AS 내부 설정에서 AS 간 설정으로 확장하려는 것이다.

## 5.6 인터넷 제어 메시지 프로토콜 (ICMP)

- 인터넷 제어 메시지 프로토콜(Internet Control Message Protocol, ICMP)은 호스트와 라우터가 서로 간에 네트워크 계층 정보를 주고받기 위해 사용된다.
- 가장 전형적인 사용 형태는 오류 보고다.
- ICMP는 종종 IP의 한 부분으로 간주되지만, ICMP 메시지가 IP 데이터그램에 담겨 전송되므로 구조적으로는 IP 바로 위에 있다.
- TCP나 UDP 세그먼트가 IP 페이로드로 전송되는 것처럼 ICMP 메시지도 IP 페이로드로 전송된다.
- ICMP 메시지에는 타입과 코드 필드가 있고, ICMP 메시지의 발생 원인이 된 IP 데이터그램의 헤더와 첫 8바이트를 갖는다.
- ICMP 메시지가 오류 상태를 알리기 위해서만 사용되는 것은 아님을 알아야 한다.
- Traceroute 역시 ICMP 메시지로 구현된다.
  - 출발지와 목적지 사이의 라우터 이름과 주소를 알아내기 위해 출발지의 Traceroute는 평범한 일련의 IP 데이터그램을 목적지에 보낸다.
  - 이 각각의 데이터그램은 없을 것 같은 UDP 포트 번호를 가진 UDP 세그먼트를 운반한다.
  - TTL 값은 첫 번째 데이터그램이 1, 두 번째는 2, 세 번째는 3, 이런 식이다.

## 5.7 네트워크 관리와 SNMP, NETCONF/YANG

- 네트워크 관리란 무엇인가?
  - 네트워크 관리는 적정한 비용으로 실시간, 운용 성능, 서비스 품질 등의 요구사항을 만족시키기 위해 네트워크와 구성요소 자원을 감시, 테스트, 폴링, 설정, 분석, 평가, 제어하는 하드웨어, 소프트웨어, 인간 요소 등을 배치하고 통합, 조정하는 것이다.

### 5.7.1 네트워크 관리 프레임

- 네트워크 관리의 핵심 요소들
  - 관리 서버
    - 네트워크 관리자와 상호작용하는 애플리케이션이다.
  - 피관리 장치
    - 관리 대상 네트워크에 존재하는 네트워크 장비(소프트웨어 포함)들이다.
  - 데이터
    - 각 피관리 장치는 '상태'라고 부르는, 장치와 관련된 데이터들을 갖는다.
    - 데이터의 유형
      - **설정 데이터(configuration data)** 는 장치 인터페이스에 관리자가 할당 및 설정한 IP 주소 또는 인터페이스 속도와 같은 장치 정보
      - **동작 데이터(operational data)** 는 OSPF 프로토콜의 인접 항목 목록처럼 장치가 동작하면서 획득하는 정보
      - **장치 통계(device statistics)** 는 인터페이스에서 삭제된 패킷 수 또는 장치의 냉각 팬 속도와 같이 장치가 운영되면서 갱신되는 상태 표시기 및 계수기다.
  - 네트워크 관리 에이전트
    - 관리 서버와 통신하는 피관리 장치상의 소프트웨어 프로세스다.
  - 네트워크 관리 프로토콜
    - 관리 서버와 피관리 장치들 사이에서 동작하면서 관리 서버가 피관리 장치의 상태에 대해 질의하고 에이전트를 통해 피관리 장치에 행동을 취할 수 있도록 해준다.
- 네트워크를 관리할 수 있는 세 가지 방법
  - CLI
  - SNMP / MIB
  - NETCONF / YANG

### 5.7.2 SNMP와 MIB

- **SNMPv3**(Simple Network Management Protocol version 3)는 관리 서버와 그 관리 서버를 대표하여 실행되고 있는 에이전트 사이에서 네트워크 관리 제어 및 정보 메시지를 전달하기 위해 사용된다.
- SNMP의 가장 흔한 사용 형태는 요청-응답 모드인데, 여기서 SNMP 관리 서버는 에이전트에게 요청을 송신하고 이를 받은 SNMP 에이전트는 이를 수행한 후 요청에 대한 응답을 보낸다.
- 일반적으로 요청은 피관리 장치와 관련된 MIP 객체 값들의 질의 또는 수정하기 위해 이용된다.
- SNMP의 두 번째로 일반적인 사용은 에이전트가 요구받지 않았더라도 트랩 메시지라는 이름의 메시지를 관리 서버에게 전송하는 것이다.
- SNMPv3는 일반적으로 PDU(Protocol Data Unit)로 알려진 일곱 가지 타입의 메시지를 정의하고 있다.
  - GetRequest, GetNextRequest, GetBulkRequest PDUs
  - SetRequest PDU
  - InformRequest PDU
  - Response PDU
  - 트랩 메시지
- 일반적으로 UDP 데이터그램의 페이로드 부분에 실린다.

#### MIB

- SNMP / MIB 방식의 네트워크 관리에서 피관리 장치의 동작 상태 데이턱 해당 장치를 위한 MIB에 수집된 객체들로 표현된다.

### 5.7.3 네트워크 설정 프로토콜 (NETCONF)과 YANG

- NETCONF 프로토콜은 관리 서버와 피관리 네트워크 장치 사이에서 동작하면서
  - 피관리 장치의 설정 데이터를 검색, 셋업, 수정하거나
  - 피관리 장치의 동작 데이터 및 통계를 질의하거나
  - 피관리 장치에서 생성된 알림을 구독하기 위한 메시지 전송 기능을 제공한다.
- 관리 서버는 피관리 장치를 제어하기 위해 구조화된 XML 문서 형식의 설정 내용을 보내 피관리 장치에서 활성화 한다.
- NETCONF는 원격 프로시저 호출 패러다임을 사용하고, XML로 인코딩된 프로토콜 메시지는 TCP 상의 TLS(Transprot Layer Security) 프로토콜과 같은 안전한 연결 지향 세션을 통해 관리 서버와 피관리 장치 사이에서 교환된다.
- 관리 서버와 피관리 장치 간의 상호작용은 `<rpc>` 와 `<rpc-reply>` 메시지를 사용하는 원격 프로시저 호출 형식을 갖는다.
- 이러한 메시지는 장치 설정 데이터와 동작 데이터 및 통계를 검색, 설정, 질의, 수정하고 장치의 알림을 구독하는 데 사용된다.
- 장치의 알림은 NETCONF의 `<notification>` 메시지를 사용하여 관리 장치에서 관리 서버로 서버가 요구 하지 않아도 자동 전송된다.
- 기본 작업을 사용하여 장치들의 집합에서 마치 하나의 작업처럼(즉, 그룹으로) 성공리에 수행되는 정교한 네트워크 관리 트랜잭션들의 집합을 만드는 것도 가능하다.
- 장치들을 트랜잭션 이전 상태로 완전히 되돌릴 수도 있다.

#### YANG

- YANG은 SMI가 SNMP의 MIB를 기술하는 데 사용되는 것과 거의 동일한 방식으로 NETCONF가 사용하는 네트워크 관리 데이터의 구조, 구문 및 의미를 정확하게 표현하는 데 사용되는 데이터 모델링 언어다
- 모든 YANG 정의는 모듈에 포함되고, 장치와 해당 기능을 설명하는 XML 문서는 YANG 모듈에서 생성할 수 있다.
- YANG은 SMI와 마찬가지로 몇 개의 내장 데이터 유형을 제공하며 데이터 모델링을 하는 사람이 유효한 NETCONF 설정에 의해 충족되어야만 하는 제약 조건을 표현할 수 있도록 한다.
