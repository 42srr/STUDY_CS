
# 6.4 스위치 근거리 네트워크 

## 6.4.1 링크 게층 주소체계와 ARP
- 호스트와 라우터는 네트워크 계층 주소, 링크 계층 주소 모두 가짐
- BUT, 링크 계층 스위치는 링크 계층 주소를 할당받지 않음
    - 통신 주체가 아니라 배달부 

- ARP(Address Resolution Protocol) 
    - IP 주소를 링크 계층 주소로 변환

##### MAC 주소
- 링크 계층 주소 = 랜 주소 = MAC 주소 
    - 다 같은 용어, 방점이 다름
    - MAC 주소
        - IEEE에서 정한 정식 기술 명칭
        - 하드웨어 고유 주소임을 강조
    - 링크 계층 주소 
        - OSI 모델 관점에서 설명할 때 쓰는 용어
    - LAN 주소
        - Local Area Network에서 사용된다는 것을 강조 
        - 같은 네트워크 내에서만 의미 있음 

- 어떤 어댑터도 동일한 MAC 주소를 가지지 않음
- 대부분의 LAN의 경우 MAC 주소는 길이가 6바이트
- 어댑터의 MAC주소는 (계층구조가 아닌) 평면 구조
    - IP주소는 네트워크 부분과 호스트 부분으로 나뉜다는 측면에서 계층 구조
    - 어댑터는 아님

- 어댑터는 어떻게 프레임을 전송하는가?
    - 프레임에 목적지 어댑터의 MAC주소를 넣고 그 프레임을 랜상으로 전송
    - 랜상의 모든 어댑터가 프레임을 받기 원하면?
        - 특수한 MAC 브로드캐스트 주소 넣음 (FF-FF-FF-FF-FF-FF)
        
##### ARP
- 네트워크 계층 주소를 링크 계층 주소로 변환 
- 목적은 DNS와 비슷함 
    - BUT DNS는 임의의 장소에 있는 애들도 처리하는 반면, 
    ARP는 같은 네트워크 상에서만 유효

- 각 호스트와 라우터는 자신의 메모리에 ARP 테이블을 갖고 있음
    - IP주소와 MAC주소 간의 매핑 정보 포함
    - TTL 값도 포함(time-to-live; 언제 삭제되는지)
        - 시간이 지나면 삭제됨

- ARP 패킷
    - 송신 노드는 ARP 패킷이라는 특수 패킷 구성
    - 송신 및 수신 IP 주소와 MAC 주소를 포함하는 필드들을 갖고 있음
    - 질의 패킷, 응답 패킷이 있음

- 그럼 ARP 테이블의 원하는 IP 주소에 대한 정보가 없다면?
    - ARP 질의 패킷을 MAC 브로드캐스트 주소(FF-FF-FF-FF-FF-FF)로 전송
    - 그럼 모든 서브넷 상의 어댑터들이 수신
    - 수신받으면 ARP모듈이 패킷에 있는 목적지 IP가 자신의 IP인지 검사
        - 맞으면 응답 ARP 패킷을 질의한 노드로 돌려보냄
        - 없으면 무시

- ARP는 플러그 앤 플레이(plug-and-play)
    - 초기 설정 없이도 작동 -> 운영이 쉬움 -> 관리 포인트 줄어듦
    - 노드의 ARP테이블이 자동으로 구축됨

- ARP는 링크 계층과 네트워크 계층 경계에 있는 프로토콜

##### 서브넷에 없는 노드로의 데이터그램 전송
- 목적지의 MAC 주소
    - 같은 서브넷이면 => 진짜 목적지의 MAC 주소
    - 다른 서브넷이면 => 라우터의 MAC 주소

- 라우터의 MAC 주소를 알기 위해 ARP브로드캐스트 보냄
    - 이 주소로 프레임을 만든다. (이 안에 진짜 목적지 IP도 포함시킴)
- 라우터가 프레임을 받은 후, 자신의 MAC 주소가 있음을 확인하면
    - IP 패킷(진짜 목적지)를 보고 라우팅 테이블 확인
- 이번엔 라우터가 ARP 브로드캐스트를 보냄 
    - 응답받으면 새로운 프레임을 만들어서 보냄 

## 6.4.2 이더넷

##### 이더넷 프레임 구조 

- 이더넷 프레임의 6개 필드
    - 데이터 필드 (46~1,500바이트)
        - 진짜 내용이 들어가 있는 구역
        - 최소 46바이트 기준을 충족 못하면 패딩으로 채워야 함
    - 목적지 주소 (6바이트)
    - 출발지 주소 (6바이트)
    - 타입 필드 (2바이트)
        - 이 프레임 안에 어떤 프로토콜이 들어있는지 알려줌
        - ex. 
            - IPv4 0x0800
            - IPv6 0x86DD
            - ARP  0x0806
    - 순환 중복 검사 (4바이트)
    - 프리앰블 (8바이트)
        - 이더넷 프레임은 프리앰블 필드로 시작
        - 첫 7바이트는 10101010 값
        - 마지막 바이트만 10101011
        - 이렇게 구성되는 이유? 
            - 반복된 패턴을 보내면서 이게 프리앰블임을 인지하게 함
            - 이걸 보면서 클럭을 똑같이 맞춤 (클럭 동기화)
            - 마지막 바이트는 이제 진짜 데이터 시작함을 알려주는 역할
            - 하드웨어 레벨 클럭 동기화 (물리 계층과 링크 계층의 연결고리)

##### 이더넷 기술
- 이더넷 표현과 약어
    - 앞의 숫자 : 표준 속도
    - BASE: 베이스밴드 이더넷(물리매체가 이더넷 트래픽만 전달함)
    - 마지막 부분: 물리 매체 

## 6.4.3 링크 계층 스위치
- 스위치의 역할 : 들어오는 링크 계층 프레임을 수신해서 출력 링크로 전달
- 스위치는 그 자체가 서브넷의 호스트와 라우터들에게 투명함
    - 투명 ? = 호스트/라우터는 스위치한테 보내는 게 아닌데 스위치가 중간에 받아서 다른 노드에게 전달하는 과정을 모른다는 뜻

##### 포워딩과 필터링
- 필터링 : 프레임을 인터페이스로 전달할지 또는 폐기할지 결정하는 스위치의 기능
- 포워딩 : 프레임이 전송될 인터페이스를 결정하고 프레임을 해당 인터페이스로 내보내는 기능
- 스위치 테이블
    - MAC 주소
    - 그 MAC주소로 가게 하는 스위치 인터페이스
    - 해당 엔트리가 테이블에 만들어진 시점에 대한 정보

##### 자가학습
- 스위치는 자신의 테이블을 자동으로, 동적으로, 자치적으로 구축하는 놀라운 특징이 있음
- 플러그 앤 플레이 장치 

##### 링크 계층 스위치의 특성
- 충돌 제거
    - 충돌로 인해 낭비되는 대역폭이 없음
    - 스위치는 프레임을 버퍼링함 
    - 스위치의 최대 총 처리율은 모든 스위치 인터페이스 속도의 합
- 이질적인 링크들
    - 스위치는 링크들을 별개로 분리
    - 랜의 각 링크는 상이한 속도로 동작 가능, 상이한 매체 사용 가능
    => 기존 장비를 새로운 장비로 사용하게 해줌
- 관리
    - 향상된 보안 제공
    - 네트워크 관리를 쉽게 해줌
    - 오동작하는 어댑터의 연결을 의도적으로 끊음
    - 대역폭 사용, 충돌률, 트래픽 종류에 대한 통계치 수집

##### 스위치 대 라우터 
- 라우터와 같이 저장 - 후 - 전달 패킷 스위치
- BUT, 라우터는 3계층 패킷 스위치, 스위치는 2계층 패킷 스위치 

- 스위치의 장단점
    - 플러그 앤 플레이 장치
        - 관리자 개입 최소화 -> 대규모 네트워크에서 안정성 증가
    - 높은 패킷 필터링 및 전달률
    
    - 브로드캐스트 트래픽의 폭주에 대비한 방안을 제공하지 않음
    - 실제 사용되는 토폴로지는 스패닝 트리로 제한됨

- 라우터의 장단점
    - 네트워크에 중복된 경로가 있을 때조차도 패킷은 라우터를 따라 순환하지 않음
    - 패킷은 스패닝 트리로 제한받지 않고 출발지와 목적지 간의 최상의 경로 사용 가능
    - 브로드캐스트 폭풍에 대비한 방화벽 보호 기능

    - 플러그 앤 플레이가 아님


## 6.4.4 가상 근거리 네트워크 (VLAN)

- 스위치 근거리 네트워크의 세가지 단점
    - 트래픽 격리의 부족
    - 스위치의 비효율적인 사용
    - 사용자 관리

=> 이 단점들을 가상 근거리 네트워크를 지원하는 스위치를 사용해서 해결
    - VLAN을 지원하는 스위치는 하나의 물리적 근거리 네트워크 인프라스트럭처상에서 여러 개의 가상 근거리 네트워크들을 정의할 수 있게 함
    - VLAN에 속한 호스트들은 마치 스위치에 자신들만 연결된 것처럼 통신
        - 근데 실제론 같은 물리적 스위치임
    - 포트 기반 VLAN에서는 네트워크 관리자가 스위치 포트를 그룹으로 나뭄
    - 각 그룹은 하나의 VLAN을 구성하며, 한 VLAN의 포트들은 하나의 브로드캐스트 도메인을 형성함

- VLAN 트렁킹
    - VLAN 스위치들을 연결하는 좀 더 확장 가능한 방법
    - 다른 VLAN들끼리 정보를 주고 받기 위한 유일한 경로

# 6.5 링크 가상화: 링크 계층으로서의 네트워크
 
## 6.5.1 다중 프로토콜 레이블 스위칭(MPLS)
- 가능한 경우에 데이터그램을 선택적으로 레이블링해서 라우터로 하여금 고정 길이 레이블을 기반으로 데이터그램을 전달할 수 있도록 목적지 기반 IP 데이터그램 전달 하부구조를 확장하는 것 

- MPLS 헤더
    - 레이블, Exp, S, TTL 

# 6.6 데이터 센터 네트워킹

## 6.6.1 데이터 센터 구조 
- 데이터 센터에서 작업을 수행하는 것은 호스트들 
    - a.k.a 블레이드
    - 범용 호스트(CPU, 메모리, 디스크 저장장치를 갖고 있음)
    - 랙에 적재됨
    - 랙의 맨 위에는 TOR스위치라고 불리는 스위치가 있음 

- 데이터 센터 네트워크가 지원하는 두 종류의 트래픽
    - 외부 클라이언트와 내부 호스트 사이의 트래픽
    - 내부 호스트 간의 트래픽

    - 외부 클라이언트와 내부 호스트 사이의 트래픽
        - 경계 라우터를 가짐
        - 경계 라우터는 데이터 센터 네트워크를 공중 인터넷으로 연결
##### 로드 밸런싱 
- 로드 밸런서
    - 데이터 센터에서 외부로부터 요청이 들어오면 먼저 로드 밸런서로 보냄
    - 로드 밸런서는 요청을 호스트에게 분배, 호스트의 현재 부하 상태에 따라서 호스트 간의 부하를 균등하게 함 
    - 대규모 데이터 센터의 경우 일반적으로 여러 대의 로드 밸런서를 갖고 있음
        - 각각 특정 애플리케이션을 위해 사용됨
    - NAT와 유사한 기능 제공
    - 클라이언트가 호스트와 직접 통신하지 못하게 함

## 6.6.2 데이터 센터 네트워킹 동향

##### 비용 감소

##### 중앙 집중형 SDN 제어 및 관리

##### 가상화

##### 물리적 제약 사항
- TCP를 변형한 방법부터 표준 이더넷에 RDMA를 구현한 방법이 제안 및 적용됨

##### 하드웨어 모듈화와 커스터마이징
- 선박 컨테이너 기반의 모듈화된 데이터 센터 
- 대규모 클라우드 제공자가 네트워크 어댑터, 스위치, 라우터, TOR, 소프트웨어, 네트워킹 프로토콜 등 데이터 센터에 있는 모든 것을 계속해서 구축하거나 커스터마이징한다는 것. 

