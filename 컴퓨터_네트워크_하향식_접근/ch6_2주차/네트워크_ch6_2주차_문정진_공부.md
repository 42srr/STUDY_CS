# 6 링크 계층과 근거리 네트워크

## 6.4 스위치 근거리 네트워크

* 스위치는 링크 게층에서 동착하기 때문에 링크 계층 프레임을 교환하고, 네트워크 계층 주소를 인식하지 않으며, 2계층 스위치들로 구성된 네트워크에서 경로를 결정하는 데 OSPF 같은 라우팅 알고리즘을 사용하지 않음.
* 스위치 네트워크에서 링크 계층 프레임을 전달하기 위해 IP주소가 아닌 링크 계층 주소 사용.

### 6.4.1 링크 계층 주소체계와 ARP

* ARP = IP 주소를 링크 계층 주소로 변환

#### MAC 주소

* 링크 계층 주소를 가진 것은 호스트나 라우터가 아닌 호스트나 라우터의 어댑터.
* 링크 계층 스위치는 호스트나 라우터를 연결해주는 인터페이스에 링크 계층 주소를 할당받지 않음.
* 링크 계층 스위치는 호스트와 라우터 간에 데이터그램을 전달하는 일을 함.
* 링크 계층 주소 = 랜 주소, 물리 주소, MAC주소
* MAC 주소의 길이는 6바이트, MAC 주소 영구적으로 설계, 소프트웨어 사용해 어댑터의 MAC 주소 변경 가능.
* MAC 주소 어떤 어댑터도 동일한 주소를 갖지 않음.
* IEEE가 MAC 주소 공간 관리

#### ARP

* ARP : 네트워크 계층 주소와 링크 계층 주소가 있으므로 이들 주소 사이에 변환이 필요하며, 이 기능을 ARP가 해줌
* ARP는 호스트 네임을 IP 주소로 해결하는 DNS와 비슷.
* DNS는 인터넷의 임의 장소에 있는 호스트 네임 해결인 반면,
* ARP는 동일한 서브넷사에 있는 호스트나 라우터 인터페이스의 IP 주소만 해결.
* 호스트와 라우터는 자신의 메모리에 ARP 테이블을 갖고 있음.
* 테이블은 IP주소와 MAC 주소 간의 매핑 정보를 포함.
* ARP 테이블은 테이블에서 각 매핑이 언제 삭제되는지 TTL 값 포함.
* ARP 테이블에 목적지 노드에 대한 엔트리 없을 때, ARP 프로토콜 사용 -> 송신 노드는 ARP 패킷을 링크 계층에서 캡슐화
* 해당 프레임의 목적지 주소를 브로드캐스트 주소로 해서 서브넷 전송.
* 질의 ARP 메시지는 브로드캐스트 프레임으로 전송하는 반면, ARP 메시지는 표준 프레임으로 전성됨.
* ARP 플러그 앤 플레이. 노드 ARP 테이블이 자동으로 구축 

#### 서브넷에 없는 노드로의 데이터그램 전송

* 읽어보시오.

### 6.4.2 이더넷

* 이터넷이 처음으로 널리 사용된 고속 랜.
* 토큰링과 FDDI, ATM이 이더넷보다 복잡하고 비싸, 네트워크 관리자는 다른 네트워크로 바꾸기 꺼림.
* 다른 랜 기술로 바꾸는 가장 중요한 이유가 새 기술의 높은 데이터율 때문이었으나, 이더넷이 그 이상의 데이터율로 동작하는 버전을 만듬.
* 허브는 프레임이 아닌 각각의 비트에 대한 처리를 하는 물리 계층 장치.
*  이터넷 설치할 때 여전히 스타 톨로지 사용했지만, 중앙의 허브가 스위치로 대체

#### 이더넷 프레임 구조

* 이더넷 프래임의 6개 필드
	* 데이터 필드
		* IP 데이터그램 운반 
		* 이더넷 최대 전송 단위 1500바이트
		* 데이터 필드 최소 크기 46바이트며, 작이믄 채워서 46바이트 만들어야함.
	* 목적지 주소
		* 목적지 어댑터의 MAC 주소 포함.
		* 6 바이트
	* 출발지 주소
		* 6 바이트
	* 타입 필드
		* 2 바이트
		* 네트워크 계층 프로코톨을 다중화 허용.
	* 순환 중복 검사
		* 4바이트
		* 수신 어댑터인 어댑터 B로 하여금 프레임 오류가 생겼는지 검출
	* 프리앰블
		* 8바이트
		* 프리앰블의 첫 7바이트는 수신 어댑터를 깨움.
	
#### 이더넷 기술

* 읽어보시오.

### 6.4.3 링크 계층 스위치

* 스위치의 역할은 들어오는 링크 계층 프레임을 수신해 출력 링크로 전달.
* 스위치는 그 자체가 서브넷의 호스트와 라우터들에게 투명.
* 호스트 / 라우터는 프레임을 스위치가 아닌 다른 호스트/라우터를 목적지로 해서 랜상으로 보내지며, 중간 스위치가 프레임을 받아 다른 노드게에 전달하는 것을 알지 못함.
* 인터페이스의 용량을 일시적으로 초과시, 라우터 출력 인터페이스가 데이터그램에 대한 버퍼를 갖고 있듯이 스위치 출력 인터페이스도 버퍼를 갖고 있음.

#### 포워딩과 필터링

* 필터링은 프레임을 인터페이스로 전달할지 또는 폐기할지 결정하는 스위치 기능
* 포워딩은 프레임이 전송될 인터페이스를 결정하고 프레임을 해당 인터페이스로 보내는 기능.
* 스위치의 필터링과 포워딩은 스위치 테이블을 이용.
	* 스위치 테이블 엔트리
		* (1) MAC 주소
		* (2) MAC 주소로 가게 하는 스위치 엔터페이스
		* (3) 해당 엔트리가 테이블에만들어진 시점에 대한 정보

#### 자가학습

* 스위치는 자가학습을 하며, 아래와 같은 능력이 있다.
	* (1) 스위치 테이블은 초기에 비어 있음.
	* (2) 수신한 각 프레임에 대해 스위치는 아래와 같은 방식으로 송신 노드가 상주하는 랜 세그먼트를 기록
		* 프래임의 출발지 주소 플드에 있는 MAC 주소
		* 프레임이 도착한 인터페이스
		* 현재 시간을 테이블에 저장
	* (3) 일정 시간이 지나눟에 스위치가 해당 주소를 출발 주소로하는 프레임을 수신 못하면 테이블에서 이 주소를 삭제.
* 스위치는 네트워크 관리자나 사용자의 개입을 요구하지 않으므로 플러그 앤 플레이 장치.

#### 링크 계층 스위치의 특성

* 충돌 제거
	* 스위치로 구축된 랜에는 충돌로 인해 낭비되는 대역폭이 없음.
* 이질적인 링크들
	* 스위치는 링크들을 별개로 분리하기 때문에 랜의 각 링크는 상이한 속도로 동족할 수 있으며 상이한 매체를 사용할 수 있다.
* 관리
	* 스위츠는 향상된 보안을 제공할 뿐만 아니라 네트워크 관리를 쉽게 할 수 있게 해준다.

#### 스위치 대 라우터

* 스위치의 장단점
	* 스우치는 상대적으로 높은 패킷 필터링 및 전달률을 갖음.
	* 브로드캐스트 프레임의 순환을 방지하기 위해 스위치 네트워크의 실제 사용되는 토폴로지는 스패닝 처리
	* 대구모 스위치 네트워크에서는 호스트와 라우터가 커다란 ARP 테이블을 갖으며, 상당한 양의 ARP 트래픽이 생성되고 처리됨
	* 스위치는 브로드캐스트 트래픽의 폭주에 대비한 방안을 제공하지 않는다.
* 라우터의 장단점
	* 네트워크 주소체계는 MAC 주소체계처럼 평면적이지 않고 보통은 계층 구조이므로, 네트워크에 중복된 경로가 있을 때조차도 패킷은 라우터를 따라 순환하지 않는다.
	* IP는 순환을 제헌하기 위해 특수 데이터그램 헤더 필드 사용
	* 패킷은 스패닝 트리로 제한 받지 않고 출발지와 목적지 간의 최상의 경로를 사용할 수 있다.
	* 라우터는 스패닝 트리와 같은 제한이 없으므로 인터넷 토폴로지 자유롭게 구축

### 6.4.4 가상 근거리 네트워크(VLAN)

* 이론적으로 잘 동작하지만 실제 상황에서는 종종 잘 동작하지 않음.
	* (1) 트래픽 격리의 부족
		* 계층 구조는 그룹 트래픽을 단일 스위치 내로 격리해주지만, 브로드캐스트 트래픽은 여전히 네트워크로 전달되어야만 함.
	* (2) 스위치의 비효율적인 사용
	* (3) 사용자 관리
* 해당 어려움은 가상 근거리 네트워크를 지원하는 스위치 사용으로 해결할 수 있음.
* VLAN을 지원하는 스위치는 하나의물리적 근거리 네트워크 인프라스트럭쳐상에서 여러 개의 가상 근거리 네트워크들을 정의할 수 있게 한다.

## 6.5 링크 가상화 : 링크 계층으로서의 네트워크
* 다중 프로토콜 레이블 스위치(MPLS)
* MPLS는 자체적인 패킷 형식과 전달 방식을 사용하며, 네트워크 계층이나 링크 계층에 해당.
* MPLS 전화 네트워크나 스위치 이더넷처럼 IP 장치를 상호연결하는 데 사용되는 링크 게층 기술로 다뤄질수 있음.

### 6.5.1 다중 프로코톨 레이블 스위칭(MPLS)
* MPLS의 목표는 고정 길이 레이블과 가상 회선을 기반으로 데이터그램을 전달하기 위해 목적기 기반 IP 데이터그램 전달 인프라스트럭쳐를 포기하는 것은 아님.
* 데이터그램을 선택적으로 레이블링해서 라우터로 하여금 고정 길이 레이블을 기반으로 데이터그램을 전달할 수 있도록 목적지 기반 IP 데이터 그램 전달 하부구조를 확장하는 것.

## 6.6 데이터 센터 네트워킹
* 데이터 센터에서 작업을 수행하는 것은 호스트
* 데이터 센터의 호스트는 블레이드라고 불림.
* 데이터 센더들은 호스트들을 20~40대 블레이드를 적재할 수 있는 랙에 적재하며, 랙의 맨 위는 TOR스위치라고 불림

### 6.6.1 데이터 센터 구조

#### 로드밸런싱
* 구글, 마소, 아마존, 알리바바에서 운영하는 클라우드 데이터 센터는 검색, 전자메일, 비디오 등 여러 애필리케이션을 동시 제공.
* 공용 IP주소가 할당되며 클라이언트는 이 IP주소로 요청보내고 이 IP주소로 응답 받음.

#### 계층적 구조
* 수천 개의 호스트만 갖고 있는 소규모 데이터 센터는 경계 라우터 1대, 로드 밸런스 1대, 단일 이더넷 스위치만으로도 모두 연결 가능한 수십 개의 랙으로 구성된 간단한 네트워크로만 충분.

### 6.6.2 데이터 센터 네트워킹 동향

* 동향은 읽어보자.

#### 6.7 총정리

* 내가 정리한것보다 이사람이 잘 정리했더라고요 읽어보시죠