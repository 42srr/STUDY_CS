# 6 링크 계층과 근거리 네트워크

## 6.4 스위치 근거리 네트워크

- 링크 계층 프레임을 전달하기 위해 IP 주소가 아닌 링크 계층 주소를 사용한다.

### 6.4.1 링크 계층 주소체계와 ARP

- IP 주소를 링크 계층 주소로 반환하는 **ARP(Address Resolution Protocol)**

#### MAC 주소

- 링크 계층 스위치는 호스트나 라우터를 연결해주는 인터페이스에 링크 계층 주소를 할당받지 않는다.
  - 링크 계층 스위가 호스트와 라우터 간에 데이터그램을 전달하는 일을 하기 때문.
- 링크 계층 주소는 **랜 주소(LAN address), 물리 주소(Physical address)** 또는 **MAC 주소(MAC address)** 로 알려져 있다.
- MAC 주소의 흥미로운 특징 중 하나는 어떤 어댑터도 동일한 주소를 갖지 않는다는 점이다.
  - IEEE가 MAC 주소 공간을 관리하기 때문
- 어댑터의 MAC 주소는 (계층 구조가 아닌) 평면 구조를 가지며 어댑터의 위치에 따라 변경되지 않는다.
- 네트워크 인터페이스에 할당된 물리적 고유 식별 주소이다.

#### ARP (Address Resolution Protocol)

- 네트워크 계층 주소와 링크 계층 주소 이들 사이에 변환을 해주는 프로토콜
- ARP는 호스트 네임을 IP 주소로 해결하는 DNS와 비슷하다.
- DNS가 인터넷의 임의의 장소에 있는 호스트의 호스트 네임을 해결해주는 반면에, ARP는 동일한 서브넷상에 있는 호스트나 라우터 인터페이스의 IP주소만을 해결한다.
- 각 호스트와 라우터는 자신의 메모리에 **ARP 테이블(ARP table)** 을 갖고 있다.
- 이 ARP 테이블은 IP 주소와 MAC 주소 간의 매핑 정보를 포함한다.
- ARP 테이블은 또한 테이블에서 각 매핑이 언제 삭제되는지를 나타내는 TTL값을 포함한다.
- 이 테이블은 서브넷 상의 모든 호스트와 라우터에 대한 엔트리를 갖고 있지 않아도 된다.
- ARP 프로토콜의 흥미로운 점
  - 질의 ARP 메시지는 브로드캐스트 프레임으로 전송되는 반면에, 응답 ARP 메지는 표준 프레임으로 전송된다.
  - ARP는 플러그 앤 플레이(plug-and-play)다.

#### 서브넷에 없는 노드로의 데이터그램 전송

### 6.4.2 이더넷

- **허브(hub)** 는 프레임이 아닌 각각의 비트에 대한 처리를 하는 물리 계층 장치다.
- 허브가 한 인터페이스로 비트를 수신하면 그 비트의 복사본을 다른 모든 인터페이스로 전송한다.
- 2000년 대 초반 중앙의 허브가 **스위치(switch)** 로 대체되었다.

#### 이더넷 프레임 구조

- 이더넷 프레임의 6개 필드
  - 데이터 필드
    - IP 데이터 그램을 운반한다.
    - 최대 전송 단위 (Maximum Transmission Unit, MTU)는 1500바이트이다.
  - 목적지 주소
  - 출발지 주소
  - 타입 필드
    - 네트워크 계층 데이그램에서의 프로토콜 필드, 트랜스포트 계층 세그먼트에서의 포트 번호와 비슷하다
    - 한 계층에서의 프로토콜을 상위 계층의 프로토콜로 연계시키는 역할을 함
  - 순환 중복 검사
  - 프리앰블
    - 이더넷 프레임은 8바이트의 프리엠블 필드로 시작한다.
- 모든 이더넷 기술은 네트워크 계층에서 비연결형 서비스를 제공해준다.
- 이더넷 기술은 네트워크 계층에게 비신뢰적인 서비스를 제공한다.

#### 이더넷 기술

- 스위치 기반 이더넷 랜에는 충돌이 없으며, 따라서 MAC 프로토콜이 필요 없다.

### 6.4.3 링크 계층 스위치

- 스위치의 역할은 들어오는 링크 계층 프레임을 수신해서 출력 링크로 전달하는 것이다.
- 스위치 그 자체가 서브넷의 호스트와 라우터들에게 **투명(transparent)** 하다.
- 즉 호스트 / 라우터는 프레임을 스위치가 아닌 다른 호스트 / 라우터를 목적으로 해서 랜상으로 보내며, 중간에 스위치가 프레임을 받아서 다른 노드에게 전달하는 것을 알지 못한다.

#### 포워딩과 필터링

- **필터링(filtering)** 은 프레임을 인터페이스로 전달할지 또는 폐기(drop)할지 결정하는 스위치의 기능이다.
- **포워딩(forwarding, 전달)** 은 프레임이 전송될 인터페이스를 결정하고 프레임을 해당 인터페이스로 내보내는 기능이다.
- 스위치의 필터링과 포워딩은 **스위치 테이블(switch table)** 을 이용한다.

#### 자가학습

- 스위치는 자신의 테이블을 자동으로, 동적으로, 자치적으로(네트워크 관리자나 구성(configuration) 프로토콜의 개입 없이) 구축하는 특징이 있다.
- 스위치는 네트워크 관리자나 사용자의 개입을 요구하지 않으므로 **플러그 앤 플레이 장치(plug-and-play device)** 다

#### 링크 계층 스위치의 특성

- 충돌 제거
  - 스위치로 구축된 랜에는 충돌로 인해 낭비되는 대역폭이 없다.
- 이질적인 링크들
  - 스위치는 링크들을 별개로 분리하기 때문에 랜의 각 링크는 상이한 속도로 동작할 수 있으며 상이한 매체를 사용할 수 있다.
- 관리
  - 스위치는 향상된 보안을 제공할 뿐만 아니라 네트워크 관리를 쉽게 할 수 있게 해준다.
  - 스위치는 대역폭 사용, 충돌률, 트래픽 종류에 대한 통계치를 수집하며, 이 정보를 네트워크 관리자가 사용할 수 있게 해준다.

#### 스위치 대 라우터

- 라우터는 네트워크 계층 주소를 사용해 패킷을 전달하는 저장-후-전달(store-and-forward) 패킷 스위치다.
- 스위치도 저장-후-전달 패킷스위치이지만, MAC 주소를 사용해서 패킷을 전달한다ㄴ 측면에서 라우터와는 근본적으로 다르다
- 라우터는 3계층 패킷 스위치인 반면, 스위치는 2계층 패킷 스위치다.
- 스위치의 장단점
  - 플러그 앤 플레이 장치
  - 상대적으로 높은 패킷 필터링 및 전달률을 갖는다.
  - 브로드캐스트 프레임의 순환을 방지하기 위해 스위치 네트워크의 실제 사용되는 토폴로지는 스패닝 트리로 제한된다.
  - 대규모 스위치 네트워크에서는호스트와 라우터가 커다란 ARP 테이블을 갖게 되며 상당한 양의 ARP 트래픽이 생성되고 처리한다.
  - 브로드캐스트 트래픽의 폭주에 대비한 방안을 제공하지 않는다.
- 라우터의 장단점
  - 네트워크 주소체계는 MAC 주소체계럼 평면적이 않고 보통은 계층구조이므로, 네트워크에 중복된 경로가 있을 때조차도 패킷은 라우터를 따라 순환되지 않는다.
  - 패킷은 스패닝 트리로 제한받지 않고 출발지와 목적지 간의 최상의 경로를 사용할 수 있다.
  - 라우터는 스패닝 트리와 같은 제한이 없으므로 인터넷 토폴로지를 자유롭게 구축될 수 있게 한다.
  - 2계층에서의 브로드캐스트 폭풍에 대비한 방화벽 보호 기능이다.
  - 플러그앤 플레이가 아니다.
  - 3계층 필드까지 처리해야 하므로 스위치보다 패킷당 처리시간이 더크다.

### 6.4.4 가상 근거리 네트워크(VLAN)

- 스위치 단점 3가지
  - 트래픽 격리의 부족
  - 스위치의 비효율적인 사용
  - 사용자 관리
- **가상 근거리 네트워크(Virtual Local Area Network, VLAN)** 을 지원하는 스위치에서 해결할 수 있다.
- VLAN을 지원하는 스위치는 하나의 물리적 근거리 네트워크 인프라스트럭처상에서 여러 개의 가상 근거리 네트워크들을 정의할 수 있게 한다.
- VLAN 스위치들을 연결하는 좀 더 확장 가능한 방법으로 **VLAN 트렁킹(VLAN trunking)** 가 있다.

## 6.5 링크 가상화 : 링크 계층으로서의 네트워크

- 다중 프로토콜 레이블 스위칭 (Multiprotocol Label Switching, MPLS) 네트워크에 대해 살펴본다.
- MPLS는 패킷 교환, 가상 회선 네트워크다.
- MPLS는 자체적인 패킷 형식과 전달 방식을 사용하며 네트워크 계층이나 링크 계층에 해당한다.

### 6.5.1 다중 프로토콜 레이블 스위칭 (MPLS)

- MPLS의 목표는 고정 길이 레이블과 가상 회선을 기반으로 데이터그램을 전달하기 위해 목적지 기반 IP 데이터그램 전달 인프라스트럭처를 포기하는 것이 아니다.
- MPLS는 가능한 경우에 데이터그램을 선택적으로 레이블링해서 라우터로 하여금 고정 길이 레이블(목적지 IP 주소가 아닌)을 기반으로 데이터그램을 전달할 수 있도록 목적지 기반 IP 데이터그램 전달 하부구조를 확장하는 것이다.
- MPLS 기능 라우터는 MPLS 레이블을 포워딩 테이블에서 찾아 적당한 출력 인터페이스로 데이터그램을 전달하여 MPLS 프레임을 전달하므로 종종 **레이블 스위치 라우터(label-switched router)** 라고 불린다.
- MPLS 기능 라우터는 목적지 IP 주소를 꺼내 볼 필요도 없고 포워딩 테이블에서 최장 프리픽스 대응을 찾을 필요도 없다.
- MPLS가 제공하는 트래픽 관리 기능이 뛰어나다.
- MPLS는 MPLS 전달 경로의 빠른 복구를 위해 사용될 수 있으며, 즉 링크 고장 시 미리 계산된 복구 경로로 트래픽을 재배정한다.
- MPLS는 **가상 사설 네트워크(VPN)** 을 구현하는 데도 사용될 수 있다.

## 6.6 데이터 센터 네트워킹

### 6.6.1 데이터 센터 구조

- 데이터 센터 네트워크는 외부 클라이언트와 내부 호스트 사이의 트래픽과 내부 호스트 간의 트래픽 등 두 종류의 트래픽을 지원한다.
- 외부 클라이언트와 내부 호스트 간 트래픽 플로우를 처리하기 위해 데이터 센터 네트워크는 하나 이상의 **경계 라우터**를 가지며, 경계 라우터는 데이터 센터 네트워크를 공중 인터넷으로 연결해준다.

#### 로드 밸런싱

- 데이터 센터에서는 외부로부터 요청이 들어오ㄴ 먼 로드 밸런서로 보내며, 로드 밸런서는 요청을 호트로 분배하고 호스트의 현재 부하 상태에 따라서 호스트 간의 부하를 균등하게 한다.

#### 계층적 구조

### 6.6.2 데이터 센터 네트워킹 동향

#### 비용 감소

#### 중앙 집중형 SDN 제어 및 관리

#### 가상화

#### 물리적 제약사항

#### 하드웨어 모듈화와 커스터마이징

## 6.7 총정리 : 웹 페이지 요청에 대한 처리

### 6.7.1 시작하기 : DHCP, UDP. IP 그리고 이더넷

### 6.7.2 여전히 시작하기 : DNS와 ARP

### 6.7.3 여전히 시작하기 : DNS 서버로의 인트라 도메인 라우팅

### 6.7.4 웹 클라이언트 - 서버 상호작용 : TCP와 HTTP

## 6.8 요약
