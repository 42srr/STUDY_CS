# 애플리케이션 계층

## 2.1 네트워크 애플리케이션의 원리
- 원칙 : 종단 시스템에서 동작하고, 종단 시스템 끼리는 네트워크를 통해 서로 통신함
    - ex. web 애플리케이션 :    서버     -  - 네트워크 - -     클라이언트 
- 네트워크 코어 장비(라우터, 링크 계층 스위치)에서 실행되는 소프트웨어까지 작성할 필요는 없음
- 여러 종단 시스템에서 실행되는 소프트웨어를 작성하면 됨

### 2.1.1 네트워크 애플리케이션 구조 

- 애플리케이션 구조 =/= 네트워크 구조 
- 애플리케이션 구조 (application architecture)
    - 고정되어있지 않고, 개발자가 설계해야 함 (네트워크는 표준화되어 있음)
        - ex. 클라이언트-서버 구조 vs P2P 구조?
        - ex. 클라이언트와 서버는 어떤 방식으로 데이터를 주고 받을 것인가? 
    - 네트워크 구조는 이미 깔려 있는 도로, 애플리케이션 구조는 그 도로 위에서 어떻게 자동차(데이터)를 움직일지를 설계 

- 클라이언트 - 서버 구조(client-server architecture)
    - 다수의 클라이언트와 하나의 서버 호스트로 이루어짐 
    - 소통 방식 : 서버에 다수의 클라이언트가 요청하면, 호스트가 클라인트에게 응답
        - 클라이언트끼리는 소통하지 않음 
    - 서버 : 항상 켜져있고, 고정 IP주소를 가짐
    - 과부하를 막기 위해서 "데이터 센터"를 운용하기도 함
        ex. 검색엔진 

- P2P 구조 (peer to peer)
    - 서버 클라이언트 구조와 달리 인프라스트럭처 서버에 최소한으로 의존
    - 대신 간헐적으로 연결된 peer 쌍들이 서로 직접 소통하게 하는 방식
    - 자가 확장성 (self-scalability)를 가짐
        - 피어들이 파일을 요구하기만 하는 것이 아니라, 다른 피어들에게 파일을 분배함 
        - 비용 효율적

### 2.1.2 프로세스 간 통신 

 - 네트워크를 통해 메시지 교환으로 서로 통신 

 #### 클라이언트와 서버 프로세스 
 - p2p 구조에서도 파일 송신 프로세스를 클라이언트 프로세스, 수신 프로세스를 서버 프로세스로 칭함

- 클라이언트와 서버 프로세스의 정의
    "두 프로세스 간의 통신 세션에서 통신을 초기화(다른 프로세스와 세션을 시작하려고 접속을 초기화)하는 프로세스를 클라이언트라 하고, 세션을 시작하기 위해 접속을 기다리는 프로세스를 서버라고 한다. 

#### 프로세스와 컴퓨터 네트워크 사이의 인터페이스 
- 프로세스는 "소켓"을 통해 네트워크로 메시지를 보내고 받음 
    - 소켓 : 호스트의 애플리케이션 계층과 트랜스포트 계층 간의 인터페이스, 네트워크 애플리케이션이 인터넷에 만든 프로그래밍 인터페이스 (= 애플리케이션과 네트워크 사이의 API)
- 개발자는 소켓의 애플리케이션 계층에 대한 통제권은 가지나, 소켓의 트랜스포트 계층에 대한 통제권은 없음 

#### 프로세스 주소 배정
- 수신 프로세스의 주소를 알아야 보낼 수 있다.
- 주소에 들어가야 하는 요소는 크게 두가지
    - (1) 호스트의 주소
    - (2) 호스트 내의 수신 프로세스를 명시하는 식별자 (=포트 번호)
        - 수신 프로세스 (즉, 수신 포켓)을 식별해야 하니 필요함

### 2.1.3 애플리케이션이 이용 간으한 트랜스포트 서비스 
- 트랜스포트 계층 프로토콜이 제공할 있는 서비스
(1) 신뢰적 데이터 전송
    - 신뢰적 데이터 전송, 손실 허용 애플리케이션 
(2) 처리율
    - 네트워크 경로를 따라  두 프로세스간의 통신 세션에서 송신 프로세스가 수신 프로세스로 비트를 전달할 . 수있는 비율
    - 처리율 요구 사항 (네트워크 애플리케시연이 원활하게 동작하기 위해 필요한 최소한의 데이터 전송속도)
        - 대역폭 민감 애플리케이션 : 처리율 요구 사항 갖는 애플리케이션
        - 탄력적 애플리케이션 : 가용한 처리율을 많으면 많은대로 
(3) 시간 보장 (timing gauarantee)
(4) 보안
    - 기밀성, 데이터 무결성, 종단인증

### 2.1.4 인터넷 전송 프로토콜이 제공하는 서비스 
- 2개의 전송 프로토콜, TCP, UDP

#### TCP 서비스
- 연결지향형 서비스
    - 메시지 전송 전 클라이언트와 서버가 서로 전송 제어 정보를 교환하게 함 
    전이중(full-duplex) 연결
- 신뢰적인 데이터 전송 서비스
    - 올바른 순서로 오류 없이 전송 
- 혼합 제어 방식

#### UDP 서비스
- 비연결형
    - 핸드셰이킹을 하지 않음
- 메시지들의 순서가 뒤바뀔수도 있고, 오류 발생할 수 있음 
- 혼합제어방식을 포함하지 않음 

### 2.1.5 애플리케이션 계층 프로토콜
- 다른 종단 시스템에서 실행되는 애플리케이션의 프로세스가 서로 메시지를 보내는 방법을 정의 

- (1) 교환 메시지 타입
- (2) 여러 메시지 타입의 문법
- (3) 필드의 의미
- (4) 언제, 어떻게 프로세스가 메시지를 전송하고 메시지에 응답하는지 결정하는 순서 

### 2.1.6 이 책에서 다루는 네트워크 애플리케이션
- 웹, 전자메일, 디렉터리 서비스, 비디오 스트리밍, p2p 애플리케이션 

## 2.2 웹과 HTTP

### 2.2.1 HTTP 개요
- HTTP(HyperText Transfer Protocol)
- 두 개의 프로그램으로 구현됨 (클라이언트, 서버)
- HTTP는 메시지의 구조 및 클라이언트와 서버가 메시지를 어떻게 교환하는지에 대해 정의

- 웹 전문용어 
    - 웹 페이지는 객체들로 구성
        - 객체 : 기본 HTML 파일과 여러 참조 객체로 구성
        - HTML 파일 : 파일 내부의 객체를 url로 참조 (url의 요소 : 호스트, 경로 이름)

- HTTP는 웹 클라이언트가 웹 서버에게 웹 페이지를 어떻게 요청하는지와 서버가 클라이언트로 어떻게 . 웹페이지를 전송하는지를 정의
- TCP를 전송 프로토콜로 사용
- 비상태 프로토콜
    - 클라이언트에 대한 정보를 유지하지 않음

### 2.2.2 비지속 연결과 지속 연결
- 비지속 연결 : 각 요구/응답이 분리된 TCP 연결을 통해 보내짐
- 지속 연결 : 모든 요구와 해당하는 응답들이 같은 TCP 연결상으로 보내짐

- *RTT* : 작은 패킷이 클라이언트로부터 서버까지 가고, 다시 클라이언트로 되돌아오는데 걸리는 시간

### 2.2.3 HTTP 메시지 포맷

#### HTTP 요청 메시지
- 각 줄은 CR(carriage return), LF(line feed)로 구성

- 첫 줄은 요청 라인
    - 3개의 필드(방식, url, http 버전) 
- 이후의 줄은 헤더 라인 
- 개체 몸체 

#### HTTP 응답 메시지 
- 상태 라인, 헤더라인, 개체 몸체로 이루어짐
- 상태 라인 (프로토콜 버전 필드, 상태 코드, 해당 상태 메시지)
- 헤더 라인 (connection, date, server, last-modified, content-length, content-type)

### 2.2.4 사용자와 서버 간의 상호작용: 쿠키
- 사이트가 사용자를 추적할 수 있게 해줌 

### 2.2.5 웹 캐싱 
- 웹 캐시는 자체의 저장 디스크를 가지고 있어 최근 호출된 객체의 사본을 저장 . 및보존 
- 조건부 GET
    - 몯든 객체가 최신의 것임을 확인하면서 캐싱을 하게  방식 
### 2.2.6 HTTP/2
- 하나의웹 페이지를 전송하기 위한 병렬 TCP 연결의 수를 줄이거나 제거하려 함
- TCP 혼잡 제어를 제어할 수 있게 됨 
- HOL 블로킹을 피하고자 함
- 메시지를 작은 프레임으로 나누고 반대편 사이트에서 재조립
- 메시지 우선순위화 

## 2.3 인터넷 전자메일

### 2.3.1 SMTP
- 모든 메시지의 몸체는 단순한 7비트 ASCII여야 함
- 중간 메일  서버를 이용하지 않음
- 지속 연결 
- SMTP 명령 : "HELLO", "MAIL FROM", "RCPT TO", "DATA", "CRLF.CRLF", "QUIT"

### 2.3.2 메일 메시지 포맷
- RFC 5322에 헤더 라인에 포함되는 주변 정보가 정의도이ㅓ 있음 
- 모든 헤더 라인은 from: 헤더 라인과 To: 헤더 라인을 반드시 가져야 함

### 2.3.3 메일 접속 프로토콜 
- 인터넷 메일 접근 프로토콜 사용 
