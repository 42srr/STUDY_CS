### 0. 개요

1. 주요 애플리케이션 계층 개념을 정의: 애플리케이션 계층 프로토콜, 클라이언트와 서버, 프로세스, 트랜스포트 계층 인터페이스 포함
2. 여러가지 네트워크 애플리케이션을 자세하게 살펴본다. (웹, 전자메일, DNS, P2P 파일 분배, 비디오 스트리밍 등)
3. TCP와 UDP 에서의 네트워크 애플리케이션 개발 (소켓 API로 간단한 서버-클라이언트 애플리케이션 개발)

### 1. 네트워크 애플리케이션의 원리

네트워크 애플리케이션 개발의 중심은 **다른 위치의 종단 시스템에서 동작하고 네트워크를 통해 서로 통신하는 프로그램** 을 개발하는 것.

따라서 여러분이 새로운 애플리케이션을 개발할 때는 여러 종단 시스템에서 실행되는 소프트웨어를 작성해야 한다. (브라우저와 웹 서버, 넷플릭스의 경우에는 사용자 단말기의 호스트와 넷플릭스 서버 호스트의 서버 프로그램이 존재한다.)

#### 1-1. 네트워크 애플리케이션 구조

네트워크 구조와 애플리케이션 구조는 다르다.

- 네트워크 구조(1장): 고정된 것
- **애플리케이션 구조(application architecture)**: 애플리케이션 개발자가 설계. 앱이 다양한 종단 시스템에서 어떻게 조직되야 하는지를 알려준다.

개발자는 보통 네트워크 애플리케이션 구조를 잘 알려진 다음 두 가지 구조로 작성 할 것이다.

1. 클라이언트-서버 구조(client-server architecture)
2. P2P 구조(peer-to-peer)

##### 클라이언트 서버 구조

**서버(server)**

- 항상 켜져 있는 호스트
- 고정된 IP
- 보통 거대한 데이터 센터 내에 위치

**클라이언트(clients)**

- 서버와 접촉하고 상호작용함
- 일반적으로 간헐적으로 통신 시도
- 일반적으로 다양한 IP 주소를 가짐
- 클라이언트끼리 직접적으로 통신하지 않음

> 예시: HTTP, IMAP, FTP

##### P2P 구조

- 항상 켜져있는 서버에 의존하지 않음
- 간헐적으로 연결된 호스트 쌍이 서로 직접 통신
- 각 피어들은 다른 피어들에게 요청(request)하며, 다른 피어들에게 서비스(혹은 response)한다.
  - 자가 확장성(self-scalability): 피어가 많아질 수록 작업 부하가 커지지만, 그와 동시에 다른 피어들에게 분배함으로써 그 시스템에 서비스 능력을 추가한다.
- 피어들은 간헐적으로 통신하고 IP를 바꾸기고 한다

> 예시: 비트토렌트(BitTorrent)

#### 1-2. 프로세스간 통신

프로세스(process): 호스트에서 실행되는 프로그램

프로세스간 통신(inter-process communication): 같은 호스트에서 두 프로세스가 통신하는 것

2개의 종단 시스템에서 프로세스는 컴퓨터 네트워크를 통해 **메시지(message)** 교환으로 서로 통신한다.

##### 소켓(socket): 프로세스와 컴퓨터 네트워크 사이의 인터페이스

프로세스는 소켓을 통해 메시지(message)를 보내거나 받는다.

- 문을 통한 비유
  - 보내는 프로세스가 문(소켓)으로 메시지(message)를 밀어 넣는다.
  - 보내는 프로세스는 트랜스포트 전송 구조가 트랜스포트 계층을 통한 후 메시지를 잘 보낸다고 가정한다. (애플리케이션 개발자는 소켓의 애플리케이션 계층에 대한 모든 통제권을 갖지만, 소켓의 트랜스포트 계층에 대한 통제권은 거의 갖지 못한다. 다른 말로는, 운영체제에게 맡긴다.)

##### 프로세스 주소 배정

한 호스트상에서 수행되고 있는 프로세스가 패킷을 다른 호스트에서 수행되고 있는 수신 프로세스가 주소(식별자)를 갖고 있어야 한다.

즉, 수신 프로세스를 식별하기 위해서는 다음 두 가지 정보가 명시되어야 합니다.

- 호스트의 주소
- 목적지 호스트 내의 수신 프로세스름 명시하는 식별자

**1. IP주소** : 4장에서 다룸

**2. 포트 번호(port number)** : https://ittrue.tistory.com/185

> 위 두 가지를 조합한 HTTP 메시지를 보내기 위한 주소의 예시:
>
> `128.119.245.12:80` <- gaia.cs.umass.edu 웹 서버의 80번 포트를 점유한 프로세스에게 메시지를 보낸다.

#### 애플리케이션이 이용 가능한 트랜스포트 서비스

애플리케이션의 소켓 반대편에는 트랜스포트 계층이 있다.

트랜스포트 계층 프로토콜이 제공하는 서비스들은 다음 네 가지 차원으로 분류할 수 있다.

1. 신뢰적 데이터 전송(reliable data transfer) (손실 허용 애플리케이션: 어느정도 손실을 허용함 (통화, 비디오 스트리밍 등))
2. 처리율 (대역폭 민감 애플리케이션: 처리율의 요구사항을 갖는 애플리케이션)
3. 시간 (비실시간 애플리케이션: 낮은 지연이 항상 높은 지연보다 선호되지만 종단 간 지연에 엄격한 제약을 받지는 않음)
4. 보안 (송신과 수신 도중 어느정도 관찰된다고 하더라도 암호화를 통해 기밀성을 제공, 이 외에도 무결성과 종단 인증이 포함)

---

**추가: 트랜스포트 계층과 트랜스포트 프로토콜의 차이**

| 개념                                               | 정의                                                                                          |
| -------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| **트랜스포트 계층 (Transport Layer)**        | OSI 7계층 중**4계층**으로, 애플리케이션이 데이터 전송을 원활하게 할 수 있도록 하는 계층 |
| **트랜스포트 프로토콜 (Transport Protocol)** | 트랜스포트 계층에서 사용되는**구체적인 프로토콜**(예: TCP, UDP)                         |

즉,  **트랜스포트 계층은 네트워크 모델에서 정의된 개념적인 계층** ,
**트랜스포트 프로토콜은 트랜스포트 계층에서 동작하는 실제 프로토콜**입니다.

#### 1-4. 인터넷 전송 프로토콜이 제공하는 서비스

**표: 다양한 네트워크 애플리케이션의 요구사항**

| **애플리케이션** | **데이터 손실 허용 여부** | **처리량(Throughput)**                     | **시간 민감도(Time Sensitivity)?**         |
| ---------------------- | ------------------------------- | ------------------------------------------------ | ------------------------------------------------ |
| 파일 전송/다운로드     | 데이터 손실 없음                | 탄력적(elastic)                                  | 없음                                             |
| 이메일                 | 데이터 손실 없음                | 탄력적(elastic)                                  | 없음                                             |
| 웹 문서                | 데이터 손실 없음                | 탄력적(elastic)                                  | 없음                                             |
| 실시간 오디오/비디오   | 데이터 손실 허용                | 오디오: 5Kbps\~1Mbps <br />비디오: 10Kbps\~5Mbps | 있음 (10~100ms 이내)                             |
| 스트리밍 오디오/비디오 | 데이터 손실 허용                | 위와 동일                                        | 있음 (몇 초 이내)                                |
| 대화형 게임            | 데이터 손실 허용                | Kbps 이상                                        | 있음 (10~100ms 이내)                             |
| 텍스트 메시징          | 데이터 손실 없음                | 탄력적(elastic)                                  | 경우에 따라 다름 (있을 수도 있고 없을 수도 있음) |

TCP 서비스:

* **신뢰성 있는 전송** : 송신 프로세스와 수신 프로세스 간
* **흐름 제어** : 송신자가 수신자를 과부하 시키지 않음
* **혼잡 제어** : 네트워크가 과부하될 때 송신자 제한
* **연결 지향** : 클라이언트와 서버 프로세스 간 설정 필요
* **제공하지 않는 것** : 시간 제약, 최소 처리량 보장, 보안

UDP 서비스:

* **신뢰성 없는 데이터 전송** : 송신 프로세스와 수신 프로세스 간
* **제공하지 않는 것** : 신뢰성, 흐름 제어, 혼잡 제어, 타이밍, 처리량 보장, 보안, 연결 설정

##### 알아두기: TLS의 보안화

기본 TCP & UDP 소켓:

* 암호화 없음
* 소켓으로 전송된 평문 비밀번호가 인터넷을 통해 그대로 평문으로 전송됨

전송 계층 보안(TLS):

* 암호화된 TCP 연결 제공
* 데이터 무결성
* 종단점 인증

TLS는 응용 계층에서 구현:

* 응용프로그램이 TLS 라이브러리를 사용하고, 이는 다시 TCP를 사용
* "소켓"으로 전송된 평문이 인터넷을 통해 암호화되어 전송됨
* 자세한 내용: 8장 참조

#### 1-5. 애플리케이션 계층 프로토콜

지금까지 네트워크 프로세스는 소켓으로 메시지를 보냄으로써 통신한다는 것을 배웠고, 트랜스포트 계층에 대해 알아봤다. ~~하향식이라면서 왜 아래 부터 봐~~

**애플리케이션 계층 프로토콜(application-layer protocol)** : 다른 종단 시스템에서 실행되는 애플리케이션의 프로세스가 서로 메시지를 보내는 방법을 정의한다. 애플리케이션 계층 프로토콜은 다음과 같은 내용을 정의한다.

- 교환 메시지 타입(ex: 요청 메시지와 응답 메시지)
- 여러 메시지의 타입과 문법(ex: 메시지 내부의 필드와 필드 간의 구별 방법)
- 필드의 의미, 즉 필드에 있는 정보의 의미
- 언제, 어떻게 프로세스가 메시지를 전송하고 메시지에 응답하는지 결정하는 규칙

중요!!! 네트워크 애플리케이션과 애플리케이션 계층 프로토콜을 구분하자.

- 네트워크 애플리케이션: 브라우저(크롬, 파이어폭스), 웹 서버(아파치, 마이크로소프트 서버)
- 웹 애플리케이션 계층 프로토콜: HTTP <- 브라우저와 웹 서버 사이에서 교환되는 메시짖의 포맷과 순서를 정의한다. (위의 4가지)

#### 1-6. 이 책에서 다루는 네트워크 애플리케이션:

다루는 것과 배우는 이유

- 웹: APP 계층 프로토콜인 HTTP 를 이해하기 위해
- 전자메일: 여러 프로토콜을 사용하기 때문에
- DNS: 네트워크 이름을 네트워크주소로 변환하는 기능이 APP 계층에 어떻게 구현되는지를 보여줌
- CDN(content distribution network): 비디오 스트리밍 온디맨드에 대해 논의하기 위함

### 2. 웹과 HTTP

#### 2-1. HTTP 개요

**HTTP: 하이퍼텍스트 전송 프로토콜**

* 웹의 응용 계층 프로토콜
* 클라이언트/서버 모델:
  * 클라이언트: 웹 객체를 요청하고, 수신하고, (HTTP 프로토콜을 사용하여) "표시"하는 브라우저
  * 서버: 요청에 대한 응답으로 (HTTP 프로토콜을 사용하여) 객체를 전송하는 웹 서버

**HTTP의 트랜스포트 계층 프로토콜: TCP**

* 클라이언트가 서버의 80번 포트로 TCP 연결을 시작(소켓 생성)
* 서버는 클라이언트로부터의 TCP 연결을 수락
* HTTP 메시지(응용 계층 프로토콜 메시지)가 브라우저(HTTP 클라이언트)와 웹 서버(HTTP 서버) 사이에서 교환됨
* TCP 연결 종료

**HTTP는 무상태(stateless)**:

* 서버는 과거 클라이언트 요청에 대한 어떤 정보도 유지하지 않음

> 추가: 웹페이지는 객체(Object)로 구성된다(HTML 파일, JPEG 이미지, JS, CSS, 비디오 클립 등)

**URL 경로 해부**

`http://www.someSchool.edu/someDepartment/picture.gif`

- http: 프로토콜
- www.someSchool.edu: 호스트 이름
- /someDepartment/picture.gif: 경로 이름

#### 2-2. HTTP 연결: 두 가지 타입

**비지속적(non-persistent) HTTP**:

* TCP 연결이 열림
* TCP 연결당 최대 하나의 객체만 전송
* TCP 연결이 닫힘
* 여러 객체를 다운로드하려면 여러 번의 연결이 필요함

**지속적(persistent) HTTP**:

* 서버에 대한 TCP 연결이 열림
* 클라이언트와 해당 서버 간의 단일 TCP 연결을 통해 여러 객체를 전송할 수 있음
* TCP 연결이 닫힘

1. **비지속적 HTTP 예시**: (교재 91쪽)

    1a. HTTP 클라이언트가[www.someSchool.edu의](http://www.someSchool.edu%EC%9D%98) 80번 포트에 있는 HTTP 서버(프로세스)로 TCP 연결을 시작

    1b.[www.someSchool.edu의](http://www.someSchool.edu%EC%9D%98) HTTP 서버가 80번 포트에서 TCP 연결을 기다리다가 연결을 "수락"하고, 클라이언트에게 알림

    2\.HTTP 클라이언트가 TCP 연결 소켓으로 HTTP 요청 메시지(URL 포함)를 전송. 이 메시지는 클라이언트가 someDepartment/home.index 객체를 원한다는 것을 나타냄

    3\.HTTP 서버가 요청 메시지를 수신하고, 요청된 객체를 포함한 응답 메시지를 생성하여 자신의 소켓으로 전송

    4\.HTTP 서버가 TCP 연결을 종료

    5\.HTTP 클라이언트가 html 파일이 포함된 응답 메시지를 수신하고, html을 표시. html 파일을 구문 분석하여 참조된 10개의 jpeg 객체를 발견

    6\.10개의 jpeg 객체 각각에 대해 1-5단계가 반복됨

**비지속적 HTTP의 단점: 응답 시간**

RTT: 작은 패킷 하나를 보냈을 때 서버로 간 후 되돌아오는 시간
